#: import lisepathl LiSE.__path__
#: import solarized LiSE.gui.style.solarized
#: import _ LiSE.util.passthru

<ClosetLabel,ClosetButton>:
    #: import lisepathl LiSE.__path__
    symbolic: False
    font_name: sep.join([lisepathl[-1], "gui", "assets", "Entypo.ttf"]) if self.symbolic else "DroidSans"
    font_size: 30 if self.symbolic else 16
<CSClosetButton>:
    symbolic: True
    stringname: _("@add")
<Board>:
    auto_bring_to_front: False
<CalendarLayout>:
    size: cal.size
    StencilView:
        Calendar:
            id: cal
            timeline: tl
            character: root.character
            cal_type: root.item_type
            keys: root.keys
            col_width: 100
            branches_wide: 2
            tick_height: 2
            spacing_x: 5
            spacing_y: 5
            editing: root.edbut.state == 'down' if root.edbut else False
            width: self.branches_wide * (self.col_width + self.spacing_x)
            height: self.tick_height * self.ticks_tall
            on_branch: tl.upd_branch
            on_tick: tl.upd_tick
        Timeline:
            id: tl
            canvas:
                Color:
                    rgba: 1, 0, 0, 1
                Line:
                    points: (self.x, self.y, self.x+cal.col_width, self.y)
                Triangle:
                    points: (self.x, self.y+8, self.x+16, self.y, self.x, self.y-8)
<Cell>:
    size_hint: (None, None)
    ColorBox:
        color: solarized["base2"]
    Label:
        text: root.text
        color: solarized["base00"]
        text_size: root.size
        pos_hint: {'x': 0, 'y': 0}
        valign: "top"
<CharSheet>:
    on_character: self.repop()
<CharSheetAdder>:
    StackLayout:
        Label:
            size_hint_y: 0.05
            text: "Add an item to the character sheet"
        TabbedPanel:
            size_hint_y: 0.9
            do_default_tab: False
            TabbedPanelItem:
                text: root.get_text(_('Tables'))
                TabbedPanel:
                    do_default_tab: False
                    TabbedPanelItem:
                        id: table_thing
                        text: root.get_text(_('Thing'))
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick things."))
                                    size_hint_y: 0.1
                                ThingListView:
                                    id: table_thing_things
                                    charsheet: root.charsheet
                                    size_hint_y: 0.3
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick stats of things."))
                                    size_hint_y: 0.1
                                NounStatListView:
                                    id: table_thing_stats
                                    specialitems: ["location"]
                                    nounitems: table_thing_things.selection
                                    charsheet: root.charsheet
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: table_thing_new_stat_in
                                        size_hint_x: 0.8
                                        hint_text: root.get_text(_("New stat name"))
                                    CSAddButton:
                                        id: table_thing_new_stat_but
                    TabbedPanelItem:
                        id: table_place
                        text: root.get_text(_('Place'))
                        StackLayout:
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick places."))
                                    size_hint_y: 0.1
                                PlaceListView:
                                    id: table_place_places
                                    charsheet: root.charsheet
                                    size_hint_y: 0.9
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick stats of places."))
                                    size_hint_y: 0.1
                                NounStatListView:
                                    id: table_place_stats
                                    nounitems: table_place_places.selection
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: table_place_new_stat_in
                                        size_hint_x: 0.8
                                        hint_text: root.get_text(_("New stat name"))                                    CSAddButton:
                                        id: table_place_new_stat_but
                    TabbedPanelItem:
                        id: table_portal
                        text: root.get_text(_('Portal'))
                        StackLayout:
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick portals."))
                                    size_hint_y: 0.1
                                PortalListView:
                                    id: table_portal_portals
                                    charsheet: root.charsheet
                                    size_hint_y: 0.9
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick stats of portals."))
                                    size_hint_y: 0.1
                                NounStatListView:
                                    nounitems: table_portal_portals.selection
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: table_portal_stat_in
                                        size_hint_x: 0.8
                                        hint_text: root.get_text(_("New stat name"))
                                    CSAddButton:
                                        id: table_portal_stat_but
                    TabbedPanelItem:
                        id: table_character
                        text: root.get_text(_('Character Stat'))
                        StackLayout:
                            Label:
                                text: root.get_text(_("Pick stats of the character."))
                                size_hint_y: 0.1
                            StatListView:
                                id: table_character_stats
                                charsheet: root.charsheet
                                size_hint_y: 0.8
                            StackLayout:
                                size_hint_y: 0.1
                                TextInput:
                                    id: table_character_stats_in
                                    size_hint_x: 0.8
                                    hint_text: root.get_text(_("New stat name"))
                                CSAddButton:
                                    id: table_character_stats_but
            TabbedPanelItem:
                text: root.get_text(_('Calendars'))
                TabbedPanel:
                    do_default_tab: False
                    TabbedPanelItem:
                        id: calendar_thing_location
                        text: root.get_text(_('Thing Location'))
                        StackLayout:
                            Label:
                                text: root.get_text(_("Pick a thing."))
                                size_hint_y: 0.1
                            ThingListView:
                                id: calendar_thing_location_thing
                                charsheet: root.charsheet
                                selection_mode: 'single'
                                size_hint_y: 0.9
                    TabbedPanelItem:
                        id: calendar_thing_stat
                        text: root.get_text(_('Thing Stat'))
                        StackLayout:
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick a thing."))
                                    size_hint_y: 0.1
                                ThingListView:
                                    id: calendar_thing_stat_thing
                                    charsheet: root.charsheet
                                    selection_mode: 'single'
                                    size_hint_y: 0.9
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick one of its stats."))
                                    size_hint_y: 0.1
                                NounStatListView:
                                    id: calendar_thing_stat_stat
                                    nounitems: calendar_thing_stat_thing.selection
                                    selection_mode: 'single'
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: calendar_thing_stat_stat_in
                                        hint_text: root.get_text(_("New stat name"))
                                        size_hint_x: 0.8
                                    CSAddButton:
                                        id: calendar_thing_stat_stat_but
                    TabbedPanelItem:
                        id: calendar_place_stat
                        text: root.get_text(_('Place Stat'))
                        StackLayout:
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick a place."))
                                    size_hint_y: 0.1
                                PlaceListView:
                                    id: calendar_place_stat_place
                                    charsheet: root.charsheet
                                    selection_mode: 'single'
                                    size_hint_y: 0.9
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick one of its stats."))
                                    size_hint_y: 0.1
                                NounStatListView:
                                    id: calendar_place_stat_stat
                                    nounitems: calendar_place_stat_place.selection
                                    charsheet: root.charsheet
                                    selection_mode: 'single'
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: calendar_place_stat_stat_in
                                        hint_text: root.get_text(_("New stat name"))
                                        size_hint_x: 0.8
                                    CSAddButton:
                                        id: calendar_place_stat_stat_but
                    TabbedPanelItem:
                        id: calendar_portal_origin
                        text: root.get_text(_('Portal Origin'))
                        StackLayout:
                            Label:
                                text: root.get_text(_("Pick a portal."))
                                size_hint_y: 0.1
                            PortalListView:
                                id: calendar_portal_origin_portal
                                charsheet: root.charsheet
                                selection_mode: 'single'
                                size_hint_y: 0.9
                    TabbedPanelItem:
                        id: calendar_portal_destination
                        text: root.get_text(_('Portal Destination'))
                        StackLayout:
                            Label:
                                text: root.get_text(_("Pick a portal."))
                                size_hint_y: 0.1
                            PortalListView:
                                id: calendar_portal_destination_portal
                                charsheet: root.charsheet
                                selection_mode: 'single'
                                size_hint_y: 0.9
                    TabbedPanelItem:
                        id: calendar_portal_stat
                        text: root.get_text(_('Portal Stat'))
                        StackLayout:
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick a portal."))
                                    size_hint_y: 0.1
                                PortalListView:
                                    id: calendar_portal_stat_portal
                                    charsheet: root.charsheet
                                    selection_mode: 'single'
                                    size_hint_y: 0.9
                            StackLayout:
                                size_hint_x: 0.5
                                Label:
                                    text: root.get_text(_("Pick one of its stats."))
                                    size_hint_y: 0.1
                                PortalListView:
                                    id: calendar_portal_stat_stat
                                    nounitems: calendar_portal_stat_portal.selection
                                    selection_mode: 'single'
                                    size_hint_y: 0.8
                                StackLayout:
                                    size_hint_y: 0.1
                                    TextInput:
                                        id: calendar_portal_stat_stat_in
                                        hint_text: root.get_text(_("New stat name"))
                                        size_hint_x: 0.8
                                    CSAddButton:
                                        id: calendar_portal_stat_stat_but
                    TabbedPanelItem:
                        id: calendar_character_stat
                        text: root.get_text(_('Character Stat'))
                        StackLayout:
                            Label:
                                text: root.get_text(_("Pick a stat."))
                                size_hint_y: 0.1
                            StatListView:
                                id: calendar_character_stat_stat
                                charsheet: root.charsheet
                                selection_mode: 'single'
                                size_hint_y: 0.8
                            StackLayout:
                                size_hint_y: 0.1
                                TextInput:
                                    id: calendar_character_stat_stat_in
                                    hint_text: root.get_text(_("New stat name"))
                                    size_hint_x: 0.8
                                CSAddButton:
                                    id: calendar_character_stat_stat_but
        BoxLayout:
            size_hint_y: 0.05
            Button:
                text: root.get_text(_("Cancel"))
                on_release: root.cancel()
            Button:
                text: root.get_text(_("Confirm"))
                on_release: root.confirm()
<ColorBox>:
    canvas:
        Color:
            rgba: self.color
        Rectangle:
            pos: self.pos
            size: self.size
<CueCard>:
    Label:
        id: l
        text_size: root.size
        color: solarized["base0"]
        pos: root.pos
        size: root.size
        halign: 'center'
        valign: 'middle'
        canvas.before:
            Color:
                rgba: solarized["base02"]
            Rectangle:
                pos: l.pos
                size: l.size
<DummyPawn>:
    size_hint: (None, None)
    do_rotation: False
    do_scale: False
<EditButton,AddButton>:
    #:import sep os.sep
    font_name: sep.join([lisepathl[-1], "gui", "assets", "Entypo.ttf"]) if self.parent else ""
    font_size: 32
    size_hint_x: 0.2
<LoadImgDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
        BoxLayout:
            size_hint_y: None
            height: 30
            ClosetButton:
                closet: root.closet
                stringname: _("Cancel")
                on_release: root.cancel()
            ClosetButton:
                closet: root.closet
                stringname: _("Load")
                on_release: root.load(filechooser.path, filechooser.selection)
<MenuIntInput>:
    padding: [12, 12, 12, 0]
    font_size: 26
<Pawn>:
    auto_bring_to_front: False
    size_hint: (None, None)
    size: pile.size
    do_rotation: False
    do_scale: False
    LayerTexPile:
        id: pile
        closet: root.board.facade.closet
        imagery: self.closet.skeleton[u"pawn"][unicode(root.board.facade.observer)][unicode(root.thing.character)][unicode(root.board.host)][unicode(root.thing)]
<PickImgDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        SwatchBox:
            id: picker
            cols: 1
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: _("Cancel")
                on_release: root.cancel()
            Button:
                text: _("Confirm")
                on_release: root.set_imgs(picker.selection)
<Spot>:
    size_hint: (None, None)
    size: pile.size
    do_rotation: False
    do_scale: False
    auto_bring_to_front: False
    LayerTexPile:
        id: pile
        closet: root.board.facade.closet
        imagery: root.board.facade.closet.skeleton[u"spot"][unicode(root.board.facade.observer)][unicode(root.board.host)][unicode(root.place)]
<SwatchBox>:
    orientation: 'vertical'
<TogSwatch,FrobSwatch>:
    text_size: (self.width, self.height * 0.9)
    halign: 'center'
    multiline: True
    size_hint: (None, None)
    BoxLayout:
        pos: root.pos
        size: root.size
        Image:
            texture: root.display_texture
            pos_hint: {'top': 0.9}
            size_hint: (0.9, 0.5)
<TableHeader>:
    size_hint_y: None
    canvas:
        Color:
            rgba: solarized["base02"]
        Rectangle:
            pos: root.pos
            size: root.size
    Label:
        id: lb
        size: self.texture_size
        bold: True
        color: solarized["base00"]
        text: root.text
<TableContent,TableBody>:
    size_hint_y: None
<TableView>:
    TableContent:
        closet: root.character.closet
<CharStatTableView>:
    CharStatTableContent:
        closet: root.character.closet
<TexPile>:
    width: max([img.right for img in self.imgs]) if len(self.imgs) > 0 else 0
    height: max([img.top for img in self.imgs]) if len(self.imgs) > 0 else 0
<LiSELayout>:
    Board:
        id: board
        facade: root.app.closet.get_character(root.app.observed_name).get_facade(root.app.closet.get_character(root.app.observer_name))
        host: root.app.closet.get_character(root.app.host_name)
    CueCard:
        id: prompt
        closet: root.app.closet
        pos_hint: {'x': 0.1, 'top': 1}
        size_hint: (None, None)
        size: (400, 26)
    CharSheetView:
        id: csview
        pos_hint: {'x': 0.7, 'y': 0.0}
        size_hint: (0.3, 1.0)
        scroll_type: ['bars']
        bar_pos_y: 'left'
        CharSheet:
            id: charsheet
            width: csview.width
            character: root.app.closet.get_character(root.app.observed_name)
            cols: 2
            spacing: 10
            cols_minimum: {0: self.width - 32 - self.spacing[0], 1: 32}
    BoxLayout:
        id: menu
        size_hint: (0.1, 1)
        orientation: 'vertical'
        spacing: 10
        ClosetButton:
            closet: root.app.closet
            stringname: _("Place...")
            fun: root.show_spot_menu
        ClosetButton:
            closet: root.app.closet
            stringname: _("Portal...")
            fun: root.make_arrow
        ClosetButton:
            closet: root.app.closet
            stringname: _("Thing...")
            fun: root.show_pawn_menu
        ClosetButton:
            closet: root.app.closet
            symbolic: True
            stringname: _("@starttime")
            fun: root.normal_speed
        ClosetButton:
            closet: root.app.closet
            symbolic: True
            stringname: _("@reversetime")
            fun: root.normal_speed
            arg: False
        ClosetButton:
            closet: root.app.closet
            symbolic: True
            stringname: _("@pause")
            fun: root.pause
        CueCard:
            closet: root.app.closet
            stringname: _("Branch:")
        MenuIntInput:
            closet: root.app.closet
            stringname: '@branch'
            fun: root.go_to_branch
        CueCard:
            closet: root.app.closet
            stringname: _("Tick:")
        MenuIntInput:
            closet: root.app.closet
            stringname: '@tick'
            fun: root.go_to_tick
<SpotMenuContent>:
    id: spotmenu
    TextInput:
        id: namer
        hint_text: root.get_text(_("Enter a unique name"))
        size_hint: (1, None)
        multiline: False
        height: self.line_height * 2
    TogSwatch:
        box: spotmenu
        img_name: "default_spot"
        text: root.get_text(_("Use default image"))
        group: "spotmenu"
        size_hint_y: None
    TogSwatch:
        box: spotmenu
        img_name: "crossroad"
        img_tags: ['?pixel_city']
        text: root.get_text(_("Build with PixelCity"))
        group: "spotmenu"
        size_hint_y: None
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: root.get_text(_('Cancel'))
            on_release: root.cancel()
        Button:
            text: root.get_text(_('Confirm'))
            on_release: root.confirm()
<PawnMenuContent>:
    id: pawnmenu
    TextInput:
        id: namer
        hint_text: root.get_text(_("Enter a unique name"))
        size_hint: (1, None)
        multiline: False
        height: self.line_height * 2
    TogSwatch:
        box: pawnmenu
        img_name: "default_pawn"
        text: root.get_text(_("Use default image"))
        group: "pawnmenu"
        size_hint_y: None
    TogSwatch:
        box: pawnmenu
        img_name: "base.mummy_f"
        img_tags: ["base", "body", "boot", "hand1", "hand2", "hair", "head", "leg", "beard", "cloak"]
        text: root.get_text(_("Build with RLTiles"))
        group: "pawnmenu"
        size_hint_y: None
    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: root.get_text(_('Cancel'))
            on_release: root.cancel()
        Button:
            text: root.get_text(_('Confirm'))
            on_release: root.confirm()
